## 5.2 用户数据报协议 UDP
### 5.2.2 UDP 的首部格式

#### UDP校验和（checksum）

## 5.3 5.3 传输控制协议 TCP

## 5.4 可靠传输
### 连续ARQ协议
- 累积确认方式
- Go-back-N (回退N)
- 发送窗口多个，接收窗口一个
	- 当用 n 比特进行分组的编号，发送窗口 $W_T$ 的最大值 $2^n-1$ 

## 5.5 TCP报文段的首部格式
- TCP 报文段首部的前 20 个字节是固定的，因此 TCP 首部的最小长度是 20 字节。

![TCP 报文段的首部格式](img/第五章%20运输层/TCP%20报文段的首部格式.png)

- 窗口字段指发送本报文段的一方的接收窗口。

## 5.6 5.6 TCP 的运输连接管理
1. TCP 建立连接的过程叫做握手。
	- 握手需要在客户和服务器之间交换三个 TCP 报文段。称之为三报文握手。
2. TCP 连接释放过程是四报文挥手。
	- ![TCP的连接释放](img/第五章%20运输层/TCP的连接释放.png)
	- TCP 连接必须经过时间 2MSL 后才真正释放掉。（防止最后一次确认丢失）

## 5.7 TCP可靠传输的实现
- TCP 在不可靠的IP服务上建立可靠的数据传输
	- 基本机制
		- 发送端：流水线式发送数据、等待确认、超时重传
		- 接收端：进行差错检测，采用累积确认机制
	- 乱序段处理：协议没有明确规定
		- 接收端不缓存：可以正常工作，处理简单，但效率低
		- 接收端缓存：效率高，但处理复杂

### 一个高度简化的TCP协议
高度简化的TCP协议：仅考虑可靠传输机制，且数据仅在一个方向上传输
- 接收方： 
	- 确认方式：采用累积确认，仅在正确、按序收到报文段后，更新确认序号；其余情况，重复前一次的确认序号（与GBN类似） 
	- 失序报文段处理：缓存失序的报文段（与SR类似） 
- 发送方： 
	- 发送策略：流水线式发送报文段 
	- 定时器的使用：仅对最早未确认的报文段使用一个重传定时器（与GBN类似） 
	- 重发策略：仅在超时后重发最早未确认的报文段（与SR类似，因为 接收端缓存了失序的报文段）

### 5.7.1 滑动窗口
- TCP 的滑动窗口是以字节为单位的。
- 发送缓存
### 5.8.2 TCP 的拥塞控制方法
- TCP使用端到端拥塞控制机制：发送方根据自己感知的网络拥塞程度，限制其发送速率
- 需要回答三个问题：
	1. 发送方如何感知网络拥塞？ 
	2. 发送方采用什么机制来限制发送速率？
	3. 发送方感知到网络拥塞后，采取什么策略调节发送速率？

1. 发送方利用丢包事件感知拥塞：
	- 重传定时器超时
	- 发送端收到3个重复的ACK
2. 发送方采用什么机制来限制发送速率？
	- TCP发送方维持一个拥塞窗口 CWND (Congestion Window)来限制发送窗口
3. 拥塞窗口的调节策略：AIMD
	- 乘法减小（Multiplicative Decrease）
	- 加法增大（Additive Increase）

#### 慢开始 (Slow start)
慢启动的基本思想：
- 在新建连接上指数增大cwnd，直至检测到丢包（此时终止慢启动） 
- 希望迅速增大cwnd至可用的发送速度

**每经过一个传输轮次 (transmission round)（一个RTT），拥塞窗口 cwnd 就加倍。**

- 慢开始门限状态变量 ssthresh
	- 当 cwnd < ssthresh 时，使用慢开始算法。 
	- 当 cwnd > ssthresh 时，停止使用慢开始算法而改用拥塞避免算法。 
	- 当 cwnd = ssthresh 时，既可使用慢开始算法，也可使用拥塞避免算法

![](img/第五章%20运输层/拥塞窗口.png)

- 超时和收到3个重复的ACK，反映的网络拥塞程度是不一样的
	- ② 超时：说明网络交付能力很差
		- 设置 $门限=cwnd/2$
		- $cwnd=1MSS$
		- 使用慢启动增大cwnd至门限
		- 使用AIMD调节cwnd
	- ④ 收到3个重复的ACK：说明网络仍有一定的交付能力
		- 快重传FR (Fast Retransmission) 算法
			- 将cwnd降至一半
			- 使用AIMD调节cwnd

