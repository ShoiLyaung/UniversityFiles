# TCP/IP

## 4.2 网际协议IP(Internet Protocol)
- 网际协议 IP 是 TCP/IP 体系中两个最主要的协议之一。
- 与 IP 协议配套使用的还有三个协议：
	- 地址解析协议 ARP (Address Resolution Protocol) 
	- 网际控制报文协议 ICMP (Internet Control Message Protocol)
	- 网际组管理协议 IGMP (Internet Group Management Protocol)

### 4.2.4 地址解析协议ARP(Address Resolution Protocol)

### 4.2.5 IP数据报的格式

### 4.2.6 IP 层转发分组的流程
- 路由表
	- 路由表没有给分组指明到某个网络的完整路径。
	- 路由表指出，到某个网络应当先到某个路由器（即**下一跳路由器**）。
- 分组转发大都是基于目的主机所在的网络，但也有特例。**特定主机路由**，这种路由是为特定的目的主机指明一个路由。
- 默认路由 (default route)
	- 路由器还可采用**默认路由**以减少路由表所占用的空间和搜索路由表所用的时间。
> - IP 数据报的首部中没有地方可以用来指明“下一跳路由器的 IP 地址” 。
> - 当路由器收到待转发的数据报，不是将下一跳路由器的IP 地址填入 IP 数据报，而是送交下层的网络接口软件。
> - 网络接口软件使用 ARP 负责将下一跳路由器的 IP 地址转换成硬件地址，并将此硬件地址放在链路层的 MAC 帧的首部，然后根据这个硬件地址找到下一跳路由器。

### 4.3.1 划分子网
- 子网掩码
	- 某位 ＝ 1：IP地址中的对应位为网络号和子网号
	- 某位 ＝ 0：IP地址中的对应位为主机号

![子网掩码](img/第四章%20网络层/子网掩码.png)

- 固定长度子网
- 变长子网

### 4.3.3 无分类编址 CIDR
- 变长子网掩码 VLSM (Variable Length Subnet Mask)
- 无分类域间路由选择 CIDR (Classless Inter-Domain Routing)
	- CIDR 使用“斜线记法”(slash notation)
	- 最长前缀匹配 (longest-prefix matching)
	- CIDR 记法
		- 把点分十进制中低位连续的 0 可以省略
- 路由聚合 (route aggregation)
	- 超网

## 4.4 网际控制报文协议 ICMP
- 网际控制报文协议 ICMP (Internet Control Message Protocol)

## 4.5 互联网的路由选择协议
- 自治系统 AS(Autonomous System)
### 4 .5.2 内部网关协议 RIP

![距离向量算法](img/第四章%20网络层/距离向量算法.png)

- RIP 协议的收敛 (convergence) 过程较快。
- RIP使用的更新算法称为**距离向量算法**
	- 距离向量算法的基础就是 Bellman-Ford 算法
- 优点：
	- 实现简单，开销较小。
- 缺点：
	- RIP 允许一条路径最多只能包含 15 个路由器（16 表示不可达）。**RIP 只适用于小型互联网**
	- 随着网络规模的扩大，开销也就增加。
	- **好消息传播得快，而坏消息传播得慢。** 这是 RIP 的一 个主要缺点，也称为**慢收敛问题**。

### 4.5.3 内部网关协议 OSPF
- OSPF(Open Shortest Path First)(开放最短路径优先)
	- 洪泛法
	- 链路状态数据库 (link-state database)
		- 全网的拓扑信息：包括网中所有的节点、各个节点间的链路连接以及各条**链路的代价**
		- 计算到其他路由器的最短路径：Dijkstra算法

#### OSPF的区域 (area)
- 为了使 OSPF 能用于规模很大的网络，OSPF 将一个自治系统再划分为若干个更小的范围，叫做**区域**。
- 每一个区域都有一个 32 位的区域标识符（用点分十进制表示）。
- 区域也不能太大，在一个区域内的路由器最好不超过 200 个。
- 好处：
	- 将洪泛的范围缩小，减少网络通信量

### 4.5.4 外部网关协议 BGP
- BGP (Border Gateway Protocol)(边界网关协议) 是不同自治系统的路由器之间交换路由信息的协议，目前使用最多的版本是BGP-4
- 边界网关协议 BGP 只能是力求寻找一条能够到达目的网络且**比较好的路由**（不能兜圈子），而并非要寻找一条最佳路由。
- BGP 采用了路径向量路由选择协议。
